# タスク実行プロセスガイドライン

## 目的

実装やドキュメント作成の前に必ず計画を立て、段階的に実行する。ユーザーの承認を得ながら作業を進め、手戻りを防ぐ。

## 基本原則

**プランニングファースト**: いきなり実装せず、必ず計画フェーズを経る

## タスク実行フロー

### 必須フェーズ

1. **計画フェーズ**: 計画を作成しファイルに保存
2. **レビューフェーズ**: ユーザーからの承認を待つ
3. **実装フェーズ**: 承認された計画に従って実装
4. **確認フェーズ**: セルフレビュー実施
5. **完了フェーズ**: ユーザーに報告

### フェーズ遷移ルール

**重要**: ユーザーの明示的な承認または指示があるまで次のフェーズに進まない。

特に以下の場合は必ず待機:
- **レビュー中**: 「レビューをお願いします」「チェックしてください」
- **検討中**: 「考えてください」「提案してください」
- **修正待ち**: 「修正してください」の後、実行指示がない場合
- **確認要求**: 「〜してから」「〜の前に」などの条件付き指示

## プランニングプロセス

### プランニングが必要な場合

以下のタスクでは必ず計画を作成:

- 新機能の実装
- 大規模な修正・リファクタリング
- 複数ファイルにまたがる変更
- ドキュメントの新規作成・大幅な改訂
- アーキテクチャの変更

### プランニングが不要な場合

以下の軽微なタスクは計画不要:
- タイポ修正
- 単一行の修正
- 明確で単純な変更（例: 変数名の変更1箇所）
- ユーザーが「計画不要」と明示した場合

### 計画作成の5ステップ

1. **タスクの理解**: 実現内容、制約条件、期待される成果物を確認
2. **計画の作成**: 実施内容、変更ファイル、実施順序、想定課題を記載
3. **ファイル保存**: `plan.md` や `.claude/` 配下に保存
4. **ユーザーレビュー**: 「以下の計画で進めてよろしいでしょうか？」と確認
5. **承認後に実装開始**: ユーザー承認を得てから実装

## 実行前の確認事項

### 1. ユーザーの意図確認

- レビュー中ではないか
- 実行の許可を得ているか
- ユーザーが「すぐに実行しないで」と指示していないか

### 2. 環境確認

- ビルドできる状態か（実行前に `go build` などで確認）
- 依存関係は満たされているか
- 必要なファイルが存在するか

### 3. 失敗時の計画

テスト実行前に：
- 失敗した場合の対処方針を持つ
- 必要に応じてユーザーに確認する準備

## 実行のタイミング

### 実行して良い場合

- ユーザーが明示的に実行を指示した
- レビューが完了し、承認された
- ビルドチェックが成功した

### 実行を待つべき場合

- レビュー中
- ユーザーが検討中
- ビルドエラーが残っている
- ユーザーが「実行しないで」と指示した

## 実践例

```
❌ 悪い例:
ユーザー: 「新機能を追加して」
Claude: [いきなり実装開始] → [完了報告]
問題: 計画なし、ユーザー確認なし、手戻り発生

✅ 良い例:
ユーザー: 「新機能を追加して」
Claude:
  1. [タスク理解]
  2. [計画作成・保存]
  3. 「計画を作成しました。この内容で進めてよろしいでしょうか？」
ユーザー: 「承認します」
Claude:
  4. [実装] → [セルフレビュー] → [完了報告]
```

## 期待される効果

- ユーザーとの認識齟齬を削減
- 手戻りの防止
- 作業の透明性向上
- 効率的なタスク実行
